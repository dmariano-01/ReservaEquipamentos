<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva de Equipamentos</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css"> 
</head>
<body>
    <div class="container">
        <h2 class="text-center">Reserva de Equipamentos para Professores</h2>
        <div id="mensagem" class="alert" role="alert" style="display: none;"></div>

        <div class="panel panel-default">
            <div class="panel-heading">Fazer Reserva</div>
            <div class="panel-body">
                <form id="formulario-reserva">
                    <div class="form-group">
                        <input type="text" id="nome-professor" class="form-control" placeholder="Nome do Professor" required>
                    </div>
                    <div class="form-group">
                        <input type="text" id="equipamento-reserva" class="form-control" placeholder="Nome do Equipamento" required>
                    </div>
                    <div class="form-group">
                        <input type="date" id="data-reserva" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <select id="aula-reserva" class="form-control" required>
                            <option value="">Selecione a Aula</option>
                            <option value="1">1ª Aula</option>
                            <option value="2">2ª Aula</option>
                            <option value="3">3ª Aula</option>
                            <option value="4">4ª Aula</option>
                            <option value="5">5ª Aula</option>
                            <option value="6">6ª Aula</option>
                            <option value="7">7ª Aula</option>
                            <option value="8">8ª Aula</option>
                            <option value="9">9ª Aula</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success">Reservar</button>
                </form>
            </div>
        </div>

        <table class="table table-bordered table-striped" id="tabela-reservas">
            <thead>
                <tr>
                    <th>Professor</th>
                    <th>Equipamento</th>
                    <th>Data</th>
                    <th>Aula</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody>
                <!-- Reservas serão exibidas aqui -->
            </tbody>
        </table>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        // Carregar reservas do Local Storage ao iniciar
        $(document).ready(function() {
            carregarReservas();
        });

        $('#formulario-reserva').submit(function(e) {
            e.preventDefault();

            var nomeProfessor = $('#nome-professor').val().trim();
            var equipamento = $('#equipamento-reserva').val().trim();
            var data = $('#data-reserva').val();
            var aula = $('#aula-reserva').val();
            var mensagem = $('#mensagem');

            mensagem.removeClass('alert-success alert-danger').hide();

            if (nomeProfessor === "" || equipamento === "" || !data || !aula) {
                mensagem
                    .addClass('alert-danger')
                    .text("Preencha todos os campos corretamente.")
                    .fadeIn();
                return;
            }

            var reserva = { nomeProfessor, equipamento, data, aula };

            adicionarReserva(reserva);
            salvarNoLocalStorage(reserva);

            $('#formulario-reserva')[0].reset();
            mensagem
                .addClass('alert-success')
                .text("Reserva realizada com sucesso!")
                .fadeIn();

            setTimeout(function() {
                mensagem.fadeOut();
            }, 3000);
        });

        function adicionarReserva(reserva) {
            // Converter a data para o formato dd/mm/aa
            var dataFormatada = formatarData(reserva.data);

            var linha = `<tr>
                <td>${reserva.nomeProfessor}</td>
                <td>${reserva.equipamento}</td>
                <td>${dataFormatada}</td>
                <td>${reserva.aula}ª Aula</td>
                <td><button class="btn btn-danger excluir">Excluir</button></td>
            </tr>`;
            $('#tabela-reservas tbody').append(linha);
        }

        function salvarNoLocalStorage(reserva) {
            var reservas = JSON.parse(localStorage.getItem('reservas')) || [];
            reservas.push(reserva);
            localStorage.setItem('reservas', JSON.stringify(reservas));
        }

        function carregarReservas() {
            var reservas = JSON.parse(localStorage.getItem('reservas')) || [];
            reservas.forEach(adicionarReserva);
        }

        function formatarData(data) {
            var partes = data.split('-'); // Divide o formato ISO (aaaa-mm-dd)
            return `${partes[2]}/${partes[1]}/${partes[0].slice(2)}`; // Reorganiza para dd/mm/aa
        }

        $(document).on('click', '.excluir', function() {
            var linha = $(this).closest('tr');
            var nomeProfessor = linha.find('td:eq(0)').text();
            var equipamento = linha.find('td:eq(1)').text();
            var data = linha.find('td:eq(2)').text();
            var aula = linha.find('td:eq(3)').text().replace('ª Aula', '');

            var reservas = JSON.parse(localStorage.getItem('reservas')) || [];
            reservas = reservas.filter(function(reserva) {
                return !(reserva.nomeProfessor === nomeProfessor &&
                         reserva.equipamento === equipamento &&
                         reserva.data === formatarDataISO(data) &&
                         reserva.aula === aula);
            });

            localStorage.setItem('reservas', JSON.stringify(reservas));
            linha.remove();

            var mensagem = $('#mensagem');
            mensagem.removeClass('alert-success alert-danger').hide();
            mensagem
                .addClass('alert-success')
                .text("Reserva excluída com sucesso!")
                .fadeIn();

            setTimeout(function() {
                mensagem.fadeOut();
            }, 3000);
        });

        function formatarDataISO(data) {
            var partes = data.split('/');
            return `20${partes[2]}-${partes[1]}-${partes[0]}`; // Reorganiza para aaaa-mm-dd
        }
    </script>
</body>
</html>
